<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tâches Dynamiques</title>

    <script>
    let taches = [
      { titre: "Faire les courses", description: "Acheter du lait", priorite: "urgent", statut: "En cours" , categorie: "personnel" },
      { titre: "Réviser l'examen", description: "Ajouter des précisions", priorite: "urgent", statut: "en cours", categorie: "maths" },
      { titre: "Préparer la réunion", description: "Diapositives", priorite: "pas urgent", statut: "terminer", categorie: "travail" }
    ];

    // Les données JSON pour les paramètres de la tâche (similaire à l'exemple categoryList)
    let categorieList = [
      {"idCategory":"1", "category": "personnel", "validCategory":"1"},
      {"idCategory":"2", "category": "travail", "validCategory":"1"},
      {"idCategory":"3", "category": "maths", "validCategory":"1"},
      {"idCategory":"4", "category": "science", "validCategory":"1"}
    ];

    // Fonction principale d'écriture dynamique
    function dynamicWriting() {
      if (taches.length > 0) {
        generateTachesTable();
      }
      generateCategorySelect();
    }

    // 1. Génération dynamique du tableau des tâches (méthode Template literals)
    // Basé sur les lignes 183-190, 212-217, 262-264 des notes de cours.
    function generateTachesTable() {
      let htmlCode = `<table><thead><tr><th>Titre</th><th>Description</th><th>Priorité</th><th>Catégorie</th><th>Statut</th></tr></thead><tbody>`;

      // Utilisation de forEach comme dans les notes [cite: 193, 206]
      taches.forEach(function(item, index) {
        // Utilisation de Template literals avec back ticks et ${variable} 
        htmlCode += `<tr>`;
        htmlCode += `<td>${item.titre}</td>`; // [cite: 213]
        htmlCode += `<td>${item.description}</td>`;
        htmlCode += `<td>${item.priorite}</td>`;
        htmlCode += `<td>${item.categorie}</td>`;
        // Le statut est ajouté à l'objet 'taches' manquant dans votre code initial, mais présent dans le modèle ci-dessus.
        htmlCode += `<td>${item.statut || 'À faire'}</td>`;
        htmlCode += `</tr>`; // [cite: 216]
      });

      htmlCode += `</tbody></table>`; // [cite: 258]
          
      // Insertion du code HTML dans l'élément 'main' [cite: 237, 262]
      // Utilisation de 'beforeend' pour ajouter le contenu à l'intérieur de <section id="main"> [cite: 240, 262]
      document.getElementById('main').insertAdjacentHTML('beforeend', htmlCode); 
    }

    // 2. Génération dynamique de la liste <select> (écriture dynamique pour le formulaire)
    // Basé sur les lignes 335-343 des notes de cours.
    function generateCategorySelect() {
          
      categoryList.forEach(function(item, index) { // Utilisation de forEach 
          
        // Création de l'option avec Template literal [cite: 340]
        let option = `<option value="${item.idCategory}">${item.category}</option>`;
          
        // Insertion de l'option dans le <select id="idCategory"> 
        // 'beforeend' est utilisé pour l'ajouter à l'intérieur du <select> après les options initiales.
        document.getElementById("idCategory").insertAdjacentHTML('beforeend', option);
      });
    }

    // Fonction d'ajout de tâche (conservée de votre code)
    function addTask() {
      let titre = document.getElementById('titre').value;
      let description = document.getElementById('description').value;
      let priorite = document.getElementById('priorite').value;
      // On récupère l'ID de la catégorie (la value du <option>)
      let idCategory = document.getElementById('idCategory').value;
      
      if (!titre || !priorite || !idCategory) {
        alert("Veuillez remplir les champs obligatoires !");
        return;
      }
      
      // Trouver le nom de la catégorie correspondant à l'ID
      let categorie = categorieList.find(cat => cat.idCategory === idCategory)?.category || 'Non spécifié';
      
      let nouvelleTache = {
        titre: titre,
        description: description,
        priorite: priorite,
        statut: "En cours", // Ajout d'un statut par défaut
        categorie: categorie
      };

      taches.push(nouvelleTache);
      console.log(taches);
      // Clear et re-générer la table
      document.getElementById('main').innerHTML = ''; // Nettoyer l'ancienne table
      generateTachesTable();
      document.querySelector('#tacheWebform').reset(); // Supposons que le formulaire a l'ID 'tacheWebform'
    }

    // Exécution de dynamicWriting une fois que le document est complètement chargé
    // Basé sur les lignes 115-121 des notes de cours.
    document.onreadystatechange = function () {
      if (document.readyState === "complete") {
        // Initialisation de l'écriture dynamique
        dynamicWriting();
        // Attacher l'événement au bouton 'Save'
        // Assurez-vous que le bouton a l'ID 'saveBtn' dans le HTML
        const saveButton = document.getElementById('saveBtn');
        if (saveButton) {
          saveButton.addEventListener('click', addTask);
        } else {
          console.error("Bouton 'saveBtn' non trouvé.");
        }
      }
    };
  </script>

</head>
<body>

    <form id="tacheWebform">
    <h3>Insérer une nouvelle tâche</h3>
    Titre : <input type="text" id="titre" required><br>
    Description : <input type="text" id="description"><br>
    Priorité : <input type="text" id="priorite" required><br>
    
        Catégorie : <select id="idCategory" required>
      <option value="">--- Choisir ---</option>     </select><br>

    <button type="button" id="saveBtn">Save</button>
  </form>
  
  <hr>

    <section id="main"></section>

</body>
</html>
